<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Suivi Musculation</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2, h3 { margin-bottom: 10px; }
    #exerciseList div { margin-bottom: 8px; }
    button { margin-left: 5px; padding: 2px 5px; }
    #weeklyBars { display: flex; gap: 5px; margin-top: 10px; }
    .dayBar { flex: 1; height: 25px; position: relative; background-color: #eee; border-radius: 5px; overflow: hidden; }
    .fillBar { height: 100%; width: 0%; text-align: center; color: white; font-size: 12px; line-height: 25px; font-weight: bold; }
    .dayLabel { text-align: center; margin-top: 3px; font-size: 12px; }
    .timer { display: inline-block; margin-left: 10px; font-weight: bold; }
    .rest { color: blue; font-weight: bold; margin-left: 10px; }
    input[type="number"] { width: 50px; margin-left: 5px; }
  </style>
</head>
<body>
  <h2>Mes Exercices du Jour</h2>
  <div id="exerciseList"></div>

  <h3>Suivi Hebdomadaire</h3>
  <div id="weeklyDashboard">
    <div id="weeklyBars"></div>
  </div>

  <audio id="restSound">
    <source src="https://www.soundjay.com/button/beep-07.wav" type="audio/wav">
  </audio>

  <script>
    const currentDay = new Date().toLocaleDateString('fr-FR', { weekday: 'long' });

    let exercises = [
      { name: "Pompes", reps: 10, sets: 3, doneSets: 0, timer: null, time: 0, restTimer: null, restTime: 0, restDuration: 60 },
      { name: "Squats", reps: 12, sets: 3, doneSets: 0, timer: null, time: 0, restTimer: null, restTime: 0, restDuration: 90 },
      { name: "Abdos", reps: 15, sets: 3, doneSets: 0, timer: null, time: 0, restTimer: null, restTime: 0, restDuration: 45 }
    ];

    const weeklySessions = { "lundi": false, "mardi": false, "mercredi": false, "jeudi": false, "vendredi": false, "samedi": false, "dimanche": false };

    const exerciseList = document.getElementById('exerciseList');
    const restSound = document.getElementById('restSound');

    function markDone(index) {
      if (exercises[index].doneSets < exercises[index].sets) {
        exercises[index].doneSets++;
        startRest(index);
      }
      renderExercises();
    }

    function startTimer(index) {
      if (exercises[index].timer) return;
      exercises[index].timer = setInterval(() => {
        exercises[index].time++;
        renderExercises();
      }, 1000);
    }

    function stopTimer(index) {
      clearInterval(exercises[index].timer);
      exercises[index].timer = null;
    }

    function startRest(index) {
      if (exercises[index].restTimer) return;
      exercises[index].restTime = 0;
      exercises[index].restTimer = setInterval(() => {
        exercises[index].restTime++;
        renderExercises();
        if (exercises[index].restTime >= exercises[index].restDuration) {
          clearInterval(exercises[index].restTimer);
          exercises[index].restTimer = null;
          exercises[index].restTime = 0;
          restSound.play();
          alert(`Repos terminé pour ${exercises[index].name} !`);
        }
      }, 1000);
    }

    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    function renderWeeklyDashboard() {
      const container = document.getElementById('weeklyBars');
      container.innerHTML = '';
      Object.keys(weeklySessions).forEach(day => {
        const barContainer = document.createElement('div');
        barContainer.style.flex = '1';
        const dayBar = document.createElement('div');
        dayBar.className = 'dayBar';
        const fillBar = document.createElement('div');
        fillBar.className = 'fillBar';
        let percent = 0;
        if (day === currentDay.toLowerCase() && exercises.length > 0) {
          const totalSets = exercises.reduce((sum, ex) => sum + ex.sets, 0);
          const doneSets = exercises.reduce((sum, ex) => sum + ex.doneSets, 0);
          percent = totalSets === 0 ? 0 : Math.round((doneSets / totalSets) * 100);
        } else {
          percent = weeklySessions[day] ? 100 : 0;
        }
        fillBar.style.width = percent + '%';
        fillBar.style.backgroundColor = percent === 100 ? '#4caf50' : (percent > 0 ? '#ff9800' : '#f44336');
        fillBar.textContent = percent + '%';
        const label = document.createElement('div');
        label.className = 'dayLabel';
        label.textContent = day;
        dayBar.appendChild(fillBar);
        barContainer.appendChild(dayBar);
        barContainer.appendChild(label);
        container.appendChild(barContainer);
      });
    }

    function renderExercises() {
      exerciseList.innerHTML = '';
      exercises.forEach((ex, index) => {
        const doneClass = ex.doneSets === ex.sets ? 'style="text-decoration: line-through; color: #777;"' : '';
        const div = document.createElement('div');
        div.className = 'exercise';
        div.innerHTML = `
          <span ${doneClass}>${ex.name} - ${ex.doneSets}/${ex.sets} sets (${ex.reps} reps)</span>
          <button onclick="markDone(${index})">+1 set</button>
          <button onclick="startTimer(${index})">▶️ Start</button>
          <button onclick="stopTimer(${index})">⏹ Stop</button>
          <span class="timer">${formatTime(ex.time)}</span>
          <label>Repos (s):
            <input type="number" min="10" value="${ex.restDuration}" onchange="exercises[${index}].restDuration=this.value">
          </label>
          ${ex.restTimer ? `<span class="rest">Repos: ${formatTime(ex.restDuration - ex.restTime)}</span>` : ''}
        `;
        exerciseList.appendChild(div);
      });
      renderWeeklyDashboard();
    }

    renderExercises();
  </script>
</body>
</html>
