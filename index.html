<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Suivi Musculation</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2, h3 { margin-bottom: 10px; }
    #exerciseList div { margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
    button { padding: 5px 10px; position: relative; }
    input[type="number"] { width: 50px; margin-left: 5px; }
    .timer { display: inline-block; font-weight: bold; min-width: 50px; }
    .restBarContainer { display: inline-block; width: 150px; height: 15px; background: #eee; border-radius: 8px; overflow: hidden; vertical-align: middle; }
    .restBarFill { height: 100%; width: 0%; background: blue; text-align: center; color: white; font-size: 10px; line-height: 15px; }
    .done { text-decoration: line-through; color: #777; }
    /* Cercle animé */
    .circle {
      width: 36px; height: 36px;
      border-radius: 50%;
      border: 3px solid #ccc;
      position: absolute;
      top: -6px; left: -6px;
      box-sizing: border-box;
    }
    .circleFill {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
      clip: rect(0px, 36px, 36px, 18px);
      border-radius: 50%;
      border: 3px solid green;
      transform: rotate(0deg);
      transform-origin: center;
    }
  </style>
</head>
<body>
  <h2>Mes Exercices du Jour</h2>
  <div id="exerciseList"></div>

  <audio id="restSound">
    <source src="https://www.soundjay.com/button/beep-07.wav" type="audio/wav">
  </audio>

  <script>
    const exercises = [
      { name: "Pompes", reps: 10, sets: 3, doneSets: 0, timer: null, time: 0, restTimer: null, restTime: 0, restDuration: 60 },
      { name: "Squats", reps: 12, sets: 3, doneSets: 0, timer: null, time: 0, restTimer: null, restTime: 0, restDuration: 90 },
      { name: "Abdos", reps: 15, sets: 3, doneSets: 0, timer: null, time: 0, restTimer: null, restTime: 0, restDuration: 45 }
    ];

    const exerciseList = document.getElementById('exerciseList');
    const restSound = document.getElementById('restSound');

    function formatTime(seconds) {
      const m = Math.floor(seconds / 60);
      const s = seconds % 60;
      return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
    }

    function markDone(index) {
      if (exercises[index].doneSets < exercises[index].sets) {
        exercises[index].doneSets++;
        startRest(index);
      }
      renderExercises();
    }

    function startTimer(index) {
      if (exercises[index].timer) return;
      exercises[index].timer = setInterval(() => {
        exercises[index].time++;
        renderExercises();
      }, 1000);
    }

    function stopTimer(index) {
      clearInterval(exercises[index].timer);
      exercises[index].timer = null;
    }

    function startRest(index) {
      if (exercises[index].restTimer) return;
      exercises[index].restTime = 0;
      exercises[index].restTimer = setInterval(() => {
        exercises[index].restTime++;
        renderExercises();
        if (exercises[index].restTime >= exercises[index].restDuration) {
          clearInterval(exercises[index].restTimer);
          exercises[index].restTimer = null;
          exercises[index].restTime = 0;
          restSound.play();
          alert(`Repos terminé pour ${exercises[index].name} !`);
        }
      }, 1000);
    }

    function renderExercises() {
      exerciseList.innerHTML = '';
      exercises.forEach((ex, index) => {
        const doneClass = ex.doneSets === ex.sets ? 'done' : '';
        const div = document.createElement('div');
        const restPercent = ex.restDuration > 0 ? Math.min((ex.restTime / ex.restDuration) * 360, 360) : 0;
        div.innerHTML = `
          <span class="${doneClass}">${ex.name} - ${ex.doneSets}/${ex.sets} sets (${ex.reps} reps)</span>
          <button onclick="markDone(${index})">+1 set
            <div class="circle">
              <div class="circleFill" style="transform: rotate(${restPercent}deg);"></div>
            </div>
          </button>
          <button onclick="startTimer(${index})">▶️ Start</button>
          <button onclick="stopTimer(${index})">⏹ Stop</button>
          <span class="timer">${formatTime(ex.time)}</span>
          <label>Repos (s):
            <input type="number" min="10" value="${ex.restDuration}" onchange="exercises[${index}].restDuration=this.value">
          </label>
          <div class="restBarContainer">
            <div class="restBarFill" style="width: ${Math.min((ex.restTime/ex.restDuration)*100, 100)}%;"></div>
          </div>
        `;
        exerciseList.appendChild(div);
      });
    }

    renderExercises();
  </script>
</body>
</html>
