<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Routine d'Exercices</title>
<style>
  body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
  .exercise { padding: 10px; margin: 10px 0; background: #fff; border-radius: 8px; }
  .timer { font-weight: bold; margin-left: 10px; }
  .completed { background-color: #88b04b !important; }
  button { margin-left: 10px; padding: 5px 10px; border-radius: 5px; border: none; cursor: pointer; }
  button:disabled { background: #ccc; cursor: not-allowed; }
</style>
</head>
<body>

<h1>Routine d'Exercices</h1>

<div id="exerciseList"></div>

<h2>Historique de la semaine</h2>
<div id="history"></div>

<audio id="ding" src="https://www.soundjay.com/buttons/sounds/button-3.mp3"></audio>

<script>
const exercises = [
  { name: "Pompes", sets: 3, reps: 12, rest: 80 },
  { name: "Squats", sets: 3, reps: 15, rest: 80 },
  { name: "Abdos", sets: 2, reps: 20, rest: 80 }
];

let currentExIndex = 0;
let currentSet = 0;
let weeklyHistory = JSON.parse(localStorage.getItem('weeklyHistory')) || [];

const dingSound = document.getElementById('ding');

function renderExercises() {
  const container = document.getElementById('exerciseList');
  container.innerHTML = '';

  exercises.forEach((ex, index) => {
    const div = document.createElement('div');
    div.className = 'exercise';
    div.id = 'ex' + index;

    let setsDone = (index < currentExIndex) ? ex.sets : (index === currentExIndex ? currentSet : 0);
    let setsDisplay = `Set ${setsDone + 1} / ${ex.sets}`;

    div.innerHTML = `
      <strong>${ex.name}</strong> - ${ex.reps} reps <span class="timer" id="timer${index}">${setsDone === ex.sets ? '✔' : ''}</span>
      <button id="start${index}" ${index === currentExIndex ? '' : 'disabled'}>Démarrer Set</button>
      <button id="done${index}" ${index === currentExIndex ? '' : 'disabled'}>Terminé</button>
    `;

    container.appendChild(div);

    document.getElementById('start' + index).onclick = () => startSet(index);
    document.getElementById('done' + index).onclick = () => markSetDone();
  });
}

function startSet(index) {
  alert(`Commencez votre set de ${exercises[index].name} (${exercises[index].reps} reps)`);
}

function markSetDone() {
  if(currentExIndex >= exercises.length) return;

  const timerDiv = document.getElementById('timer' + currentExIndex);
  if(timerDiv.dataset.resting === "true") return;

  const ex = exercises[currentExIndex];
  weeklyHistory.push({ day: new Date().toLocaleDateString(), name: ex.name, reps: ex.reps });
  localStorage.setItem('weeklyHistory', JSON.stringify(weeklyHistory));

  currentSet += 1;

  if(currentSet < ex.sets){
    startRestTimer(ex.rest);
  } else {
    currentExIndex += 1;
    currentSet = 0;
  }

  renderExercises();
  renderHistory();
}

function startRestTimer(seconds){
  const timerDiv = document.getElementById('timer' + currentExIndex);
  timerDiv.dataset.resting = "true";
  timerDiv.style.backgroundColor = '#f0a500';
  let timeLeft = seconds;
  timerDiv.textContent = timeLeft;

  const interval = setInterval(() => {
    timeLeft -= 1;
    timerDiv.textContent = timeLeft;
    if(timeLeft <= 0){
      clearInterval(interval);
      timerDiv.style.backgroundColor = '#88b04b';
      timerDiv.textContent = '✔';
      timerDiv.dataset.resting = "false";
      dingSound.play();
      renderExercises();
    }
  }, 1000);
}

function renderHistory() {
  const container = document.getElementById('history');
  container.innerHTML = weeklyHistory.map(h => `${h.day}: ${h.name} - ${h.reps} reps`).join('<br>');
}

// Initial render
renderExercises();
renderHistory();
</script>
</body>
</html>
